<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.camping.mapper.BookingEquipMapper">

    <resultMap id="BookingEquipResultMap" type="com.camping.entity.BookingEquip">
        <id column="booking_equip_id" property="bookingEquipId" javaType="java.lang.Long"/>
        <result column="booking_id" property="bookingId" javaType="java.lang.Long"/>
        <result column="equip_id" property="equipId" javaType="java.lang.Long"/>
        <result column="quantity" property="quantity" javaType="java.lang.Integer"/>
    </resultMap>

    <select id="selectByBookingId" parameterType="java.lang.Long" resultMap="BookingEquipResultMap">
        SELECT booking_equip_id, booking_id, equip_id, quantity
        FROM booking_equips
        WHERE booking_id = #{bookingId}
    </select>

    <select id="sumQuantityByEquipAndDate" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT COALESCE(SUM(be.quantity), 0)
        FROM booking_equips be
        JOIN bookings b ON be.booking_id = b.booking_id
        WHERE be.equip_id = #{equipId}
        AND b.status IN (0, 1)
        AND NOT (b.check_out &lt;= #{checkIn} OR b.check_in &gt;= #{checkOut})
    </select>

    <insert id="insert" parameterType="com.camping.entity.BookingEquip" useGeneratedKeys="true" keyProperty="bookingEquipId">
        INSERT INTO booking_equips (booking_id, equip_id, quantity)
        VALUES (#{bookingId}, #{equipId}, #{quantity})
    </insert>

    <delete id="deleteByBookingId" parameterType="java.lang.Long">
        DELETE FROM booking_equips
        WHERE booking_id = #{bookingId}
    </delete>

</mapper>
